<!DOCTYPE html>
<html>
<head>
<title>Meal Planner</title>
<script>
async function getMenu() {
  const response = await fetch('https://dining.berkeley.edu/menus/');
  const text = await response.text();
  const parser = new DOMParser();
  const htmlDoc = parser.parseFromString(text, 'text/html');

  // Adjust selector as needed based on the actual menu structure
  const menuSections = htmlDoc.querySelectorAll('.meal-menu');
  let allMenuItems = [];

  menuSections.forEach(section => {
    const mealName = section.querySelector('h2').textContent.trim();
    const items = Array.from(section.querySelectorAll('.menu-item')).map(item => {
      const itemName = item.querySelector('.item-name').textContent.trim();
      const itemNutrition = item.querySelector('.nutrition-info');
      let nutritionData = {};

      if (itemNutrition) {
        const nutritionText = itemNutrition.textContent.trim();
        // Simple parsing, needs robust error handling and potentially regex
        const matches = nutritionText.match(/Calories: (\d+).*Carbs: (\d+)g.*Protein: (\d+)g.*Fat: (\d+)g/);
        if (matches) {
          nutritionData = {
            calories: parseInt(matches[1]),
            carbs: parseInt(matches[2]),
            protein: parseInt(matches[3]),
            fat: parseInt(matches[4])
          };
        }
      }
      return { name: itemName, nutrition: nutritionData, meal: mealName };
    });
    allMenuItems = allMenuItems.concat(items);
  });
  return allMenuItems;
}

function recommendMeals(menu, goal) {
  let filteredMeals = [];
  let totalCarbs = 0;
  let totalProtein = 0;
  let totalFat = 0;
  let totalCalories = 0;

  // Simple goal-based selection, needs refinement
  if (goal.toLowerCase().includes('carbs')) {
    filteredMeals = menu.filter(item => item.nutrition.carbs > 0);
    filteredMeals.sort((a, b) => b.nutrition.carbs - a.nutrition.carbs);
  } else if (goal.toLowerCase().includes('protein')) {
    filteredMeals = menu.filter(item => item.nutrition.protein > 0);
    filteredMeals.sort((a, b) => b.nutrition.protein - a.nutrition.protein);
  } else if (goal.toLowerCase().includes('fat')) {
    filteredMeals = menu.filter(item => item.nutrition.fat > 0);
    filteredMeals.sort((a, b) => b.nutrition.fat - a.nutrition.fat);
  } else if (goal.toLowerCase().includes('calories')) {
      filteredMeals = menu.filter(item => item.nutrition.calories > 0);
      filteredMeals.sort((a,b) => b.nutrition.calories - a.nutrition.calories);
  }

  const selectedMeals = [];
  const maxMeals = 5; // Limit to a reasonable number of meals

  for (let i = 0; i < Math.min(maxMeals, filteredMeals.length); i++) {
    const meal = filteredMeals[i];
    if(meal.nutrition.carbs){
      totalCarbs += meal.nutrition.carbs;
    }
    if(meal.nutrition.protein){
      totalProtein += meal.nutrition.protein;
    }
    if(meal.nutrition.fat){
      totalFat += meal.nutrition.fat;
    }
    if(meal.nutrition.calories){
      totalCalories += meal.nutrition.calories;
    }
    selectedMeals.push(meal);
  }

  return { meals: selectedMeals, totals: {carbs: totalCarbs, protein: totalProtein, fat: totalFat, calories: totalCalories}};
}

async function generateMealPlan() {
  const goal = document.getElementById('goalInput').value;
  const menu = await getMenu();
  const mealPlan = recommendMeals(menu, goal);

  const resultDiv = document.getElementById('result');
  resultDiv.innerHTML = '<h2>Recommended Meal Plan:</h2>';

  if (mealPlan.meals.length === 0) {
    resultDiv.innerHTML += '<p>No meals found matching your goal.</p>';
    return;
  }

  mealPlan.meals.forEach(meal => {
    resultDiv.innerHTML += `<p><strong>${meal.name}</strong> (${meal.meal}) - Carbs: ${meal.nutrition.carbs}g, Protein: ${meal.nutrition.protein}g, Fat: ${meal.nutrition.fat}g, Calories: ${meal.nutrition.calories}cal</p>`;
  });
  resultDiv.innerHTML += `<p><strong>Total:</strong> Carbs: ${mealPlan.totals.carbs}g, Protein: ${mealPlan.totals.protein}g, Fat: ${mealPlan.totals.fat}g, Calories: ${mealPlan.totals.calories}cal</p>`;
}
</script>
</head>
<body>
  <h1>Meal Planner</h1>
  <label for="goalInput">Enter your macro goal:</label>
  <input type="text" id="goalInput" placeholder="e.g., Eat more carbs">
  <button onclick="generateMealPlan()">Generate Meal Plan</button>
  <div id="result"></div>
</body>
</html>